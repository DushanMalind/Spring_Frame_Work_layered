<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shop System</title>
  <link rel="stylesheet" href="assets/css/bootstrap.css">


</head>
<style>
  .mb-3 {
    width: 500px;
  }

  .hidden {
    display: none !important;
  }

  .c {
    height: 400px;
    overflow-y: scroll;
  }

</style>
<body>

<header>
  <nav class="navbar navbar-expand-lg navbar bg-dark d-flex flex-row ">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01"
              aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
        <a class="navbar-brand text-white" href="#">Shop System</a>
        <ul class="navbar-nav me-auto ms-2 mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active text-white" aria-current="page" href=#" id="customers">Customer</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="#" id="items">Item</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="#" id="orders">Order Details</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="#" id="placeOrders">Place Orders</a>
          </li>

        </ul>
        <form class="d-flex" role="search">
          <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success" type="submit">Search</button>
        </form>
      </div>
    </div>
  </nav>
</header>


<div class="container text-center" id="customerContent">
  <div class="row align-items-start">
    <div class="col">
      <h2 class="text-primary text-center m-lg-100 pt-5 ">Customer Details</h2>
      <section class="container col border-dark m-4 border rounded object-fit-contain  me-auto ms-20 mb-10">

        <div class="row">
          <div class="col">
            <h2 class="text-danger text-center m-lg-100 pt-5  text-primary">Customer Details</h2>
            <form id="customerFrom" class="row p-4 m-0 m-lg-2  justify-content-center">
              <div class="mb-3">
                <label for="txtCustomerID" class="form-label " id="cids">ID</label>
                <input type="text" name="id" class="form-control" id="txtCustomerID" aria-describedby="emailHelp">
                <span class="control-error" style="color: red" id="lblCusId"></span>
              </div>
              <div class="mb-3">
                <label for="txtCustomerName" class="form-label">Name</label>
                <input type="text" name="name" class="form-control" id="txtCustomerName">
                <span class="control-error" style="color: red" id="lblCusName"></span>
              </div>
              <div class="mb-3">
                <label for="txtCustomerAddress" class="form-label">Address</label>
                <input type="text" name="address" class="form-control" id="txtCustomerAddress">
                <span class="control-error" style="color: red" id="lblCusAddress"></span>
              </div>
              <div class="mb-3">
                <label for="txtCustomerContact" class="form-label">Contact</label>
                <input type="text" name="salary" class="form-control" id="txtCustomerContact">
                <span class="control-error" style="color: red" id="lblContact"></span>
              </div>


              <button id="save" type="button" style="width: 150px"
                      class="btn btn-warning m-auto m-lg-2 justify-content-center">Save
              </button>
              <button id="btnUpdate" type="button" style="width: 150px" class="btn btn-info m-auto m-lg-2" >
                Update
              </button>
              <button id="btnDelete" type="button" style="width: 150px" class="btn btn-dark m-auto m-lg-2">Delete
              </button>
              <button id="btnClear" type="button" style="width: 150px" class="btn btn-danger m-auto m-lg-2">Clear
              </button>
            </form>
          </div>
        </div>

      </section>

    </div>
    <div class="col">

      <div class="col">
        <h2 class="text-primary text-center m-lg-100 pt-5 ">Customer Details</h2>
        <section class="container col border-dark m-4 border rounded object-fit-contain  me-auto ms-20 mb-10">

          <h5 class="text-danger text-center m-lg-3 pb-3">Customer Details</h5>
          <div class="col-12 col-lg-12 mt-3 c">
            <table class="table table-light table-striped" id="tables">
              <thead>
              <tr>
                <th style="background-color: #0077b6" scope="col">Customer Id</th>
                <th style="background-color: #0077b6" scope="col">Customer Name</th>
                <th style="background-color: #0077b6" scope="col">Customer Address</th>
                <th style="background-color: #0077b6" scope="col">Customer Contact</th>
                <!--   <th style="background-color: #0077b6" scope="col">Action</th>-->
              </tr>
              </thead>
              <tbody id="tblCus">

              </tbody>
            </table>
            <!--<table class="table table-bordered table-hover">
              <thead class="bg-danger text-white">
              <tr>
                <th>Customer ID</th>
                <th>Customer Name</th>
                <th>Customer Address</th>
                <th>Contact</th>
              </tr>
              </thead>
              <tbody id="tblCus">

              </tbody>
            </table>-->
          </div>
        </section>


      </div>

    </div>
  </div>


</div>

<div class="container text-center" id="itemContent">
  <div class="row align-items-start">
    <div class="col">
      <h2 class="text-primary text-center m-lg-100 pt-5 ">Item Details</h2>
      <section class="container col border-dark m-4 border rounded object-fit-contain  me-auto ms-20 mb-10">

        <div class="row">
          <div class="col">
            <h2 class="text-danger text-center m-lg-100 pt-5  text-primary">Item Details</h2>
            <form id="ItemFromData" class="row p-4 m-0 m-lg-2  justify-content-center">
              <div class="mb-3">
                <label for="txtItemId" class="form-label " id="cids1">ID</label>
                <input type="text" name="code" class="form-control" id="txtItemId" aria-describedby="emailHelp">
                <span class="control-error" style="color: red" id="lblItemId"></span>
              </div>
              <div class="mb-3">
                <label for="txtItemDescription" class="form-label">Description</label>
                <input type="text" name="description" class="form-control" id="txtItemDescription">
                <span class="control-error" style="color: red" id="lblItemDesc"></span>
              </div>
              <div class="mb-3">
                <label for="txtItemUnitprice" class="form-label">Unitprice</label>
                <input type="text" name="unitPrice" class="form-control" id="txtItemUnitprice">
                <span class="control-error" style="color: red" id="lblItemUnit"></span>
              </div>
              <div class="mb-3">
                <label for="txtItemQty" class="form-label">Qty</label>
                <input type="text" name="qty" class="form-control" id="txtItemQty">
                <span class="control-error" style="color: red" id="lblItemQty"></span>
              </div>


              <button id="btnItemSave" type="button" style="width: 150px"
                      class="btn btn-warning m-auto m-lg-2 justify-content-center">Save
              </button>
              <button id="btnItemUpdate" type="button" style="width: 150px" class="btn btn-info m-auto m-lg-2">Update
              </button>
              <button id="btnItemDelete" type="button" style="width: 150px" class="btn btn-dark m-auto m-lg-2">Delete
              </button>
              <button id="btnClearItem" type="button" style="width: 150px" class="btn btn-danger m-auto m-lg-2">Clear
              </button>
            </form>
          </div>
        </div>

      </section>

    </div>
    <div class="col">

      <div class="col">
        <h2 class="text-primary text-center m-lg-100 pt-5 ">Item Details</h2>
        <section class="container col border-dark m-4 border rounded object-fit-contain  me-auto ms-20 mb-10">

          <h5 class="text-danger text-center m-lg-3 pb-3">Item Details</h5>
          <div class="col-12 col-lg-12 mt-3 c">
            <table class="table table-light table-striped">
              <thead>
              <tr>
                <th style="background-color: #0077b6" scope="col">Id</th>
                <th style="background-color: #0077b6" scope="col">Description</th>
                <th style="background-color: #0077b6" scope="col">Unitprice</th>
                <th style="background-color: #0077b6" scope="col">Qty</th>
                <!--<th style="background-color: #0077b6" scope="col">Action</th>-->
              </tr>
              </thead>
              <tbody id="tblItem">


              </tbody>
            </table>
          </div>
        </section>

      </div>

    </div>
  </div>

</div>

<section class="row mt-3 border border-danger rounded p-3 " id="ordersContent">
  <div class="col">
    <h2 class="text-primary text-center m-lg-100 pt-5 ">Order Details</h2>
    <section class="container col me-auto ms-20 mb-10">

      <!--<h5 class="text-danger text-center m-lg-3 pb-3" >Item Details</h5>-->
      <table class="table table-light table-striped">
        <thead>
        <tr>
          <th style="background-color: #0077b6" scope="col">OrderId</th>
          <th style="background-color: #0077b6" scope="col">Date</th>
          <th style="background-color: #0077b6" scope="col">CustomerID</th>
          <th style="background-color: #0077b6" scope="col">ItemID</th>
          <th style="background-color: #0077b6" scope="col">Qty</th>
          <th style="background-color: #0077b6" scope="col">Discount</th>
          <th style="background-color: #0077b6" scope="col">Total</th>
          <!--  <th style="background-color: #da9aef" scope="col">Action</th>-->
        </tr>
        </thead>
        <tbody>
        <tr>
          <th scope="row">OD001</th>
          <td>2022-05-21</td>
          <td>C001</td>
          <td>I001</td>
          <td>10</td>
          <td>4000</td>
          <td>80000</td>
          <!-- <td>
               <button type="button" class="btn btn-primary">Edit</button>
               <button type="button" class="btn btn-danger">Delete</button>
           </td>-->
        </tr>
        </tbody>
      </table>


    </section>

  </div>
</section>

<div class="container " id="placeOrdersContent">
  <div class="row align-items-start">
    <div class="col">
      <section class="container row mt-3 border border-danger rounded p-3 ">
        <h2 class="text-primary m-lg-50 pt-5 ">Order Details</h2>
        <section class="row mt-3 border border-dark rounded p-3 ">
          <section class="container col border-dark m-4 border rounded object-fit-contain ">
            <div class="row border border-dark rounded p-2">

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Order ID</span>
                  <input class="form-control" type="text" id="orderId" placeholder="OD-001"
                         aria-label="Disabled input example">
                </div>
              </div>
              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Date</span>
                  <input class="form-control" type="date" id="txtDate" placeholder="2023-05-21" aria-label="Disabled input example">
                </div>
              </div>
              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">CustomerID</span>
                  <select class="form-select" id="selectCusID" aria-label="Default select example">
                    <!-- <option>Select</option>-->
                  </select>
                </div>
              </div>

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Customer Id</span>
                  <input class="form-control" id="customerIdOrd" type="text" placeholder="Id"
                         aria-label="Disabled input example" disabled>
                </div>
              </div>

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Customer Name</span>
                  <input class="form-control" id="customerNameOrd" type="text" placeholder="Name"
                         aria-label="Disabled input example" disabled>
                </div>
              </div>

            </div>


          </section>


        </section>

        <h2 class="text-danger m-lg-50 pt-5 ">Item Details</h2>
        <section class="row mt-3 border border-dark rounded p-3 ">
          <section class="container col border-dark m-4 border rounded object-fit-contain  ">
            <div class="row border border-dark rounded p-2 ">

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Item ID</span>
                  <select class="form-select" id="selectItemCode" aria-label="Default select example">
                    <!-- <option>Select</option>-->
                  </select>
                </div>
              </div>

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">ItemCode</span>
                  <input class="form-control" id="orderItemCode" type="text" placeholder="I001"
                         aria-label="Disabled input example" disabled>
                </div>
              </div>

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Description</span>
                  <input class="form-control" id="orderItemDescription" type="text" placeholder="Ram"
                         aria-label="Disabled input example" disabled>
                </div>
              </div>

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Qty On Hand</span>
                  <input class="form-control" id="orderQTYOnHand" type="text" placeholder="10"
                         aria-label="Disabled input example" disabled>
                </div>
              </div>

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Unit Price</span>
                  <input class="form-control" id="orderItemPrice" type="text" placeholder="2000.00"
                         aria-label="Disabled input example" disabled>
                </div>
              </div>

              <div class="col">
                <div class="input-group">
                  <span class="input-group-text">Quantity</span>
                  <input class="form-control" id="txtQty" type="text" placeholder=""
                         aria-label="Disabled input example">
                </div>
              </div>

            </div>


          </section>

        </section>
        <div class="row mt-3">
          <div class="col-10"></div>
          <div class="col-2">
            <button type="button" id="btnAddToCart" class="btn btn-warning">Add to Cart</button>
            <button type="button" class="btn btn-info">Clear</button>
          </div>
        </div>
      </section>


      <section class="row mt-3 border border-danger rounded p-3 ">
        <div class="col">
          <h2 class="text-primary text-center m-lg-100 pt-5 ">Cart Details</h2>
          <section class="container col me-auto ms-20 mb-10">


            <section class="container ">
              <div class="row border border-primary rounded p-2">

                <div class="px-3 rounded-3 mt-4 p-3 border shadow-sm">
                  <div class="row px-lg-0 px-xxl-4 px-sm-5 mt-0 mt-lg-2 mt-xl-1 mt-xxl-3 ">
                    <div class="col-5">
                      <div class="mb-2 mb-lg-3 mb-xxl-3">
                        <label for="total" class="form-label fs-5">Total(RS)</label>
                      </div>
                    </div>
                    <div class="col">
                      <div class="mb-2">
                        <input type="number" readonly class="form-control p-1 fs-6 fw-bolder " id="total"
                               value="00000.00">
                      </div>
                    </div>
                  </div>

                  <div class="row px-lg-0 px-sm-5 px-xxl-4">
                    <div class="col-5">
                      <div class="mb-2">
                        <label for="subTotal" class="form-label fs-5">Sub Total(RS)</label>
                      </div>
                    </div>
                    <div class="col">
                      <div class="mb-2">
                        <input type="number" readonly class="form-control p-1 fs-6 fw-bolder " id="subTotal"
                               value="00000.00">
                      </div>
                    </div>
                  </div>

                  <div class="row gx-3 mt-4">
                    <div class="col">
                      <div class="mb-3">
                        <label for="cash" class="form-label">Cash</label>
                        <input type="text" class="form-control" id="cash" placeholder="0000.00">
                      </div>
                    </div>
                    <div class="col">
                      <div class="mb-3 mb-xxl-4">
                        <label for="discount" class="form-label">Discount</label>
                        <input type="number" class="form-control" id="discount" placeholder="10">
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="mb-3 mb-xl-5 mb-xxl-4">
                      <label for="balance" class="form-label">Balance</label>
                      <input type="text" class="form-control" id="balance" placeholder="0000.00">
                    </div>
                    <div class="mt-1 d-grid col-6 mt-xl-2 mx-auto">
                      <button id="purchaseOrder" type="button" class="btn btn-success">Purchase</button>
                    </div>
                  </div>
                </div>

              </div>


            </section>


          </section>
          <section>
            <div class="mb-5 mt-4 table-wrapper-scroll-y my-custom-scrollbar ">
              <table class="table table-hover table-borderless table-striped">
                <thead class=" text-light" style="background-color: #264259;">
                <tr>
                  <th scope="col">Item Code</th>
                  <th scope="col">Item Name</th>
                  <th scope="col">Price</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Total(Rs)</th>
                </tr>
                </thead>
                <tbody id="tblCart">
                </tbody>
              </table>
            </div>
          </section>

        </div>
      </section>


    </div>

  </div>

</div>
<!--<script type="text/javascript">
    window.addEventListener('beforeunload',()=>{
        event.preventDefault();
        event.returnValue="";
    })
   alert("Are you sure")
</script>-->

<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/jquery-3.7.0.min.js"></script>
<script src="assets/js/jquery-3.6.1.min.js"></script>
<!--<script src="controller/validations/customervalidations.js"></script>-->
<!--<script src="controller/validations/itemValideations.js"></script>-->
<!--<script src="controller/customerJs.js"></script>-->
<!--<script src="controller/ItemJs.js"></script>-->
<!--<script src="controller/ordersjs.js"></script>-->


<script>
  initiateUI();

  function initiateUI() {
    clearAllDash();
    $("#customerContent").css("display", "block");

    setTheLastView();
  }

  function saveLastView(clickedID) {
    switch (clickedID) {
      case "customerContent":
        localStorage.setItem("view", "CUSTOMER");
        break;
      case "itemContent":
        localStorage.setItem("view", "ITEM");
        break;
      case "ordersContent":
        localStorage.setItem("view", "ORDERS");
        break;
      case "placeOrdersContent":
        localStorage.setItem("view", "PLACEORDERS");
        break;
    }
  }

  function setTheLastView() {
    let view = localStorage.getItem("view");
    switch (view) {
      case "CUSTOMER":
        setView($("#customerContent"));
        break;
      case "ITEM":
        setView($("#itemContent"));
        break;
      case "ORDERS":
        setView($("#ordersContent"));
        break;
      case "PLACEORDERS":
        setView($("#placeOrdersContent"));
        break;
      default:
        setView($("#customerContent"));
    }
  }


  function clearAllDash() {
    $("#customerContent,#itemContent,#ordersContent,#placeOrdersContent").css("display", "none");
  }

  function setView(viewOb) {
    clearAllDash();
    viewOb.css("display", "block");
    saveLastView(viewOb.get(0).id);
    console.log(viewOb.get(0).id);
  }

  $("#customers").click(function () {
    setView($("#customerContent"));
  });

  $("#items").click(function () {
    setView($("#itemContent"));
  });

  $("#orders").click(function () {
    setView($("#ordersContent"));
  });

  $("#placeOrders").click(function () {
    setView($("#placeOrdersContent"));
  });


  const BASE_URL = "http://localhost:8081/O14_Spring_Data_JPA_war/";



  getAllCustomer();

  function getAllCustomer() {
    $("#tblCus").empty();
    $.ajax({
      url: "http://localhost:8081/O14_Spring_Data_JPA_war/test",
      method: "GET",
      headers: {
        Auth: "user=admin,pass=admin"
      },

      success: function (res) {
        let customers = res.data;
        for (let i = 0; i < customers.length; i++) {
          let id = customers[i].id;
          let name = customers[i].name;
          let address = customers[i].address;
          let salary = customers[i].salary;

          // console.log(id,name,address,contact);

          let row = `<tr><td>${id}</td><td>${name}</td><td>${address}</td><td>${salary}</td></tr>`;
          $("#tblCus").append(row);
        }
      }, error: function (error) {
        console.log(error);
        // alert(error.responseJSON.message);
      }
    });
  }


  $("#tblCus").on('click', function (event) {
    let tr = $(event.target).closest("tr");

    let id = tr.find("td:eq(0)").text();
    let name = tr.find("td:eq(1)").text();
    let address = tr.find("td:eq(2)").text();
    let salary = tr.find("td:eq(3)").text();

    setFiledSet(id, name, address, salary);
    // console.log(id,name,address,salary);
  });

  function setFiledSet(id, name, address, salary) {
    $("#txtCustomerID").val(id);
    $("#txtCustomerName").val(name);
    $("#txtCustomerAddress").val(address);
    $("#txtCustomerContact").val(salary);
  }


  $("#save").click(function () {
    let formData = $("#customerFrom").serialize();
    console.log(formData);

    $.ajax({
      url: BASE_URL + "test",
      method: "POST",
      data: formData,
      headers: {
        Auth: "user=admin,pass=admin"
      },
      success: function (res) {
        alert("Customer Saved");
        getAllCustomer();
        clearAll();
      }, error: function (error) {
        console.log(error);
        alert(error.responseJSON.message);
      }

    });
  });

  function clearAll() {
    $("#txtCustomerID").val("");
    $("#txtCustomerName").val("");
    $("#txtCustomerAddress").val("");
    $("#txtCustomerContact").val("");
  }


  $("#btnUpdate").click(function () {

    let id = $("#txtCustomerID").val();
    let name = $("#txtCustomerName").val();
    let address = $("#txtCustomerAddress").val();
    let contact = $("#txtCustomerContact").val();

    let cusData = {
      id: id,
      name: name,
      address: address,
      salary: contact
    };

    $.ajax({
      url: BASE_URL + "test",
      method: "PUT",
      data: JSON.stringify(cusData),
      contentType: "application/json",
      headers: {
        Auth: "user=admin,pass=admin"
      },

      success: function (res) {
        alert(res.message);
        getAllCustomer();
        clearAll();

      }, error: function (error) {
        console.log(error);
        alert(error.responseJSON.message);
      }
    });

  });


  $("#btnDelete").click(function () {
    let formData = $("#customerFrom").serialize();
    let id = $("#txtCustomerID").val();
    $.ajax({
      url: BASE_URL + "test?id=" + id,
      method: "DELETE",
      data: formData,
      headers: {
        Auth: "user=admin,pass=admin"
      },
      success: function (res) {
        alert(res.message);
        getAllCustomer();
        clearAll();

      }, error: function (error) {
        console.log(error);
        alert(error.responseJSON.message);
      }
    });

  });


  /*-------------------------------------------------------------*/


  getAllItems();

  function getAllItems() {
    $("#tblItem").empty();

    $.ajax({
     // url: BASE_URL + "item",
      url: "http://localhost:8081/O14_Spring_Data_JPA_war/item",
      method: "GET",
      headers: {
        Auth: "user=admin,pass=admin"
      },

      success: function (res) {
        let items = res.data;
        for (let i = 0; i < items.length; i++) {
          let id = items[i].code;
          let description = items[i].description;
          let unitPrice = items[i].unitPrice;
          let qtyOnHand = items[i].qtyOnHand;

          let row = `<tr><td>${id}</td><td>${description}</td><td>${unitPrice}</td><td>${qtyOnHand}</td></tr>`;
          $("#tblItem").append(row);
        }

      }, error: function (error) {
       // console.log(error);
        alert(error.responseJSON.message);
      }

    });
  }

  $("#tblItem").on('click', function () {
    let tr = $(event.target).closest("tr");

    let id = tr.find("td:eq(0)").text();
    let description = tr.find("td:eq(1)").text();
    let unitPrice = tr.find("td:eq(2)").text();
    let qty = tr.find("td:eq(3)").text();

    setFiledSetItem(id, description, unitPrice, qty);
    // console.log(id,description,unitPrice,qty);
  });

  function setFiledSetItem(id, description, unitPrice, qty) {
    $("#txtItemId").val(id);
    $("#txtItemDescription").val(description);
    $("#txtItemUnitprice").val(unitPrice);
    $("#txtItemQty").val(qty);
  }

  function clearAllItem() {
    $("#txtItemId").val("");
    $("#txtItemDescription").val("");
    $("#txtItemUnitprice").val("");
    $("#txtItemQty").val("");
  }


  $("#btnItemSave").click(function () {
    let formDataItem = $("#ItemFromData").serialize();
    console.log(formDataItem);

    $.ajax({
      url: BASE_URL + "item",
      method: "POST",
      data: formDataItem,
      headers: {
        Auth: "user=admin,pass=admin"
      },


      success: function (resp) {
        getAllItems();
        clearAllItem();
        alert(resp.message);

      }, error: function (error) {
        //console.log(error);
        alert(error.responseJSON.message);
      }

    });
  });


  $("#btnItemUpdate").click(function () {
    let id = $("#txtItemId").val();
    let description = $("#txtItemDescription").val();
    let unitPrice = $("#txtItemUnitprice").val();
    let qty = $("#txtItemQty").val();

    let itemData = {
      code: id,
      description: description,
      unitPrice: unitPrice,
      qtyOnHand: qty
    };

    $.ajax({
      url: BASE_URL + "item",
      method: "PUT",
      data: JSON.stringify(itemData),
      contentType: "application/json",
      headers: {
        Auth: "user=admin,pass=admin"
      },

      success: function (res) {
        alert(res.message);
        getAllItems();
        clearAllItem();

      }, error: function (error) {
        console.log(error);
        alert(error.responseJSON.message);
      }
    });

  });


  $("#btnItemDelete").click(function () {
    let formDataItem = $("#ItemFromData").serialize();
    let id = $("#txtItemId").val();
    $.ajax({
      url: BASE_URL + "item?id=" + id,
      method: "DELETE",
      data: formDataItem,
      headers: {
        Auth: "user=admin,pass=admin"
      },
      success: function (res) {
        alert(res.message);
        getAllItems();
        clearAllItem();

      }, error: function (error) {
        //console.log(error);
        alert(error.responseJSON.message);
      }
    });

  });


  /*-------------------------------------------------------------------------------------*/

  loadAllItem();

  function loadAllItem() {
    $("#selectItemCode").empty();
    $.ajax({
      url: BASE_URL + "item",
      method: "GET",
      headers: {
        Auth: "user=admin,pass=admin"
      },

      success: function (res) {
        let items = res.data;
        for (let i = 0; i < items.length; i++) {
          let id = items[i].code;
         /* let description = items[i].description;
          let unitPrice = items[i].unitPrice;
          let qty = items[i].qty;*/

          let row = `<option>${id}</option>`;
          $("#selectItemCode").append(row);
        }

      }, error: function (error) {
        console.log(error);
        alert(error.responseJSON.message);
      }

    });
  }

  loadAllCustomers();

  function loadAllCustomers() {
    $("#selectCusID").empty();
    $.ajax({
      url: BASE_URL + "test",
      method: "GET",
      headers: {
        Auth: "user=admin,pass=admin"
      },

      success: function (res) {
        let customers = res.data;
        for (let i = 0; i < customers.length; i++) {
          let id = customers[i].id;
         /* let name = customers[i].name;
          let address = customers[i].address;
          let contact = customers[i].contact;*/

          let row = `<option>${id}</option>`;
          $("#selectCusID").append(row);
        }

      }, error: function (error) {
        console.log(error);
        alert(error.responseJSON.message);
      }

    });
  }

  setDates();

  function setDates(){
    let data=new Date().toJSON().split('T')[0];
    $("#txtDate").val(data);
  }


  searchCustomers();

  function searchCustomers(cusId){
    let response="";
    $.ajax({
      url:BASE_URL+"test",
      dataType:"json",
      async:false,
      headers: {
        Auth: "user=admin,pass=admin"
      },

      success:function (resp){
        response=resp.data.filter((c)=>{
          return c.id==cusId;
        })
      }
    });
    return response;
  }

searchItems();
  function searchItems(code){
    let response="";
    $.ajax({
      url:BASE_URL+"item",
      dataType:"json",
      async:false,
      headers: {
        Auth: "user=admin,pass=admin"
      },

      success:function (resp){
        response=resp.data.filter((c)=>{
          return c.code==code;
        })
      }
    });
    return response;
  }



  $("#selectCusID").change(function (){
    let cusId=$("#selectCusID").val();
    $("#customerIdOrd").val(cusId);
    let res=searchCustomers(cusId);
    if (res.length>0){
      $("#customerNameOrd").val(res[0].name);

    }
  });


  $("#selectItemCode").change(function (){
    let code=$("#selectItemCode").val();
    $("#orderItemCode").val(code);
    let res=searchItems(code);
    if (res.length>0){
      $("#orderItemDescription").val(res[0].description);
      $("#orderQTYOnHand").val(res[0].qtyOnHand);
      $("#orderItemPrice").val(res[0].unitPrice);

    }
  })

  let cartItemsRow=[];
  //let orderDetails;

  $("#btnAddToCart").click(function (){
    let code=$("#orderItemCode").val();
    let description=$("#orderItemDescription").val();
    let unitPrice=$("#orderItemPrice").val();
    let avQty=$("#txtItemQty").val();
    let qty=$("#txtQty").val();
    let orderId=$("#orderId").val();



    let total=unitPrice*qty;

    let itemOB={
      oid:orderId,
      itemCode:code,
      description:description,
      unitPrice:unitPrice,
      qty:qty
    }

    cartItemsRow.push(itemOB);

    let row=`<tr><td>${code}</td><td>${description}</td><td>${unitPrice}</td><td>${qty}</td><td>${total}</td></tr>`;
    $("#tblCart").append(row);

    //orderDetails.push(cartItemsRow);

    calculateTotal();
    clearAllCart();
  });

  function calculateTotal(){
    let total=0;
    $("#tblCart tr").each(function (){
      let price=$(this).find("td:eq(4)").text();
      total+=parseFloat(price);
    });
    $("#total").val(total);
    $("#subTotal").val(total);


    $("#cash").keyup(function (){
      let cash=$("#cash").val();
      let subTotal=$("#subTotal").val();
      let balance=cash-subTotal;
      $("#balance").val(balance);
    });

  }

  function clearAllCart(){
    $("#orderItemCode").val("");
    $("#orderItemDescription").val("");
    $("#orderQTYOnHand").val("");
    $("#orderItemPrice").val("");
    $("#txtQty").val("");
  }


  $("#purchaseOrder").click(function (){
    let orderId=$("#orderId").val();
    let date=$("#txtDate").val();
    let customerId=$("#customerIdOrd").val();
    let itemId=$("#orderItemCode").val();
    let qty=$("#txtQty").val();
    let unitPrice=$("#orderItemPrice").val();

    let order={
      oid:orderId,
      date:date,
      cusID:customerId,
      orderDetails:cartItemsRow
    };

    console.log(JSON.stringify(order));

    $.ajax({
      url:BASE_URL+"purchase",
      method:"POST",
      data:JSON.stringify(order),
      contentType:"application/json",
      headers: {
        Auth: "user=admin,pass=admin"
      },
      setRequestHeader:"Access-Control-Allow-Origin",

      success:function (resp){
        alert(resp.message);
      },
      error:function (error){
        //console.log(error);
        alert(error.responseJSON.message);
      }
    });

  });


  function getItemDetails(){
    let row=$("#tblCart").children.length;
    var arry=[];

    for (let i=0;i<row;i++){
      let code=$("#tblCart").find("td:eq(0)").text();
      let description=$("#tblCart").find("td:eq(1)").text();
      let unitPrice=$("#tblCart").find("td:eq(2)").text();
      let qty=$("#tblCart").find("td:eq(3)").text();
      arry.push({code:code,description:description,unitPrice:unitPrice,qty:qty});
    }
    return arry;
  }

</script>
</body>
</html>
